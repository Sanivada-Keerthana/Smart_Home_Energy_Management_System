<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register | Smart Home Energy Management System</title>

<style>
:root {
    --primary: #667eea;
    --secondary: #764ba2;
}

/* ===== UI STYLES (UNCHANGED) ===== */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    flex-direction: column;
}

header {
    background: #fff;
    padding: 12px;
    text-align: center;
}

header img { width: 90px; }

header h1 { font-size: 22px; }

.container {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}

.card {
    background: white;
    width: 100%;
    max-width: 480px;
    padding: 40px;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.25);
}

h2 { text-align: center; margin-bottom: 8px; }

p {
    text-align: center;
    color: #666;
    margin-bottom: 25px;
}

.form-group { margin-bottom: 18px; }

label {
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
}

input, select {
    width: 100%;
    padding: 12px;
    border-radius: 6px;
    border: 2px solid #ddd;
}

input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
}

.strength-bar {
    height: 5px;
    background: #e0e0e0;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 6px;
}

.strength-indicator {
    height: 100%;
    width: 0;
    transition: 0.3s;
}

.requirements {
    font-size: 12px;
    margin-top: 8px;
    color: #666;
}

button {
    width: 100%;
    padding: 13px;
    margin-top: 10px;
    border: none;
    border-radius: 6px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    font-size: 16px;
    cursor: pointer;
}

.message {
    display: none;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
}

.message.show { display: block; }

.error { background: #ffeaea; color: #c62828; }
.success { background: #eaffea; color: #2e7d32; }

footer {
    background: #fff;
    text-align: center;
    padding: 10px;
}
</style>
</head>

<body>

<header>
    <img src="/images/shems_logo.jpeg">
    <h1>Smart Home Energy Management System</h1>
</header>

<div class="container">
    <div class="card">

        <h2>Create Account</h2>
        <p>Register to manage your smart home</p>

        <div id="errorMessage" class="message error"></div>
        <div id="successMessage" class="message success"></div>

        <form onsubmit="handleSignup(event)">
            <div class="form-group">
                <label>Role</label>
                <select id="role" required>
                    <option value="">Select Role</option>
                    <option value="OWNER">Owner</option>
                    <option value="FAMILY_MEMBER">Family Member</option>
                    <option value="GUEST">Guest</option>
                </select>
            </div>

            <div class="form-group">
                <label>Username</label>
                <input type="text" id="username" required>
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" required>
            </div>

            <div class="form-group" style="position: relative;">
                <label>New Password</label>

                <input type="password"
                    id="newPassword"
                    oninput="checkStrength()"
                    required
                    style="padding-right: 40px; position: relative; z-index: 1;">

                <!-- Eye toggle -->
                <img id="toggleNewPassword"
                    src="/images/open_eye.png"
                    alt="Toggle password visibility"
                    style="
                        position:absolute;
                        right:12px;
                        top:40px;
                        width:20px;
                        height:20px;
                        cursor:pointer;
                        z-index: 10;
                    ">

                <div class="strength-bar">
                    <div id="strengthIndicator" class="strength-indicator"></div>
                </div>

                <div class="requirements">
                    Min 8 chars, uppercase, lowercase & digit
                </div>
            </div>


            <div class="form-group" style="position: relative;">
                <label>Confirm Password</label>

                <input type="password"
                id="confirmPassword"
                required
                style="padding-right: 40px;">

            <!-- Eye toggle -->
            <img id="toggleConfirmPassword"
                src="/images/open_eye.png"
                alt="Toggle password visibility"
                style="
                    position:absolute;
                    right:12px;
                    top:37px;
                    width:20px;
                    height:20px;
                    cursor:pointer;
                    z-index: 10;
                ">
        </div>


            <button type="submit">Create Account</button>
        </form>
    </div>
</div>

<footer>
    &copy; 2026 Smart Home Energy Management System
</footer>

<script>
const API_URL = 'http://localhost:8081/api/auth';

/* ===== Password Strength ===== */
function checkStrength() {
    const p = newPassword.value;
    let s = 0;
    if (p.length >= 8) s += 25;
    if (/[A-Z]/.test(p)) s += 25;
    if (/[a-z]/.test(p)) s += 25;
    if (/\d/.test(p)) s += 25;

    strengthIndicator.style.width = s + "%";
    strengthIndicator.style.background =
        s < 50 ? "red" : s < 75 ? "orange" : "green";
}

/* ===== Signup Handler ===== */
async function handleSignup(e) {
    e.preventDefault();

    if (!role.value || !username.value || !email.value || !newPassword.value || !confirmPassword.value) {
        showError("All fields are required");
        return;
    }

    if (newPassword.value !== confirmPassword.value) {
        showError("Passwords do not match");
        return;
    }

    try {
        const response = await fetch(`${API_URL}/signup`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username: username.value.trim(),
                email: email.value.trim(),
                password: newPassword.value,
                role: role.value
            })
        });

        const data = await response.json();

        if (response.ok && data.success) {
            showSuccess("Account created successfully! Redirecting...");
            setTimeout(() => location.href = "/login", 1500);
        } else {
            showError(data.message || "Registration failed");
        }
    } catch (err) {
        showError("Server not reachable. Please try again.");
    }
}

/* ===== Messages ===== */
function showError(msg) {
    errorMessage.textContent = msg;
    errorMessage.classList.add("show");
    successMessage.classList.remove("show");
}

function showSuccess(msg) {
    successMessage.textContent = msg;
    successMessage.classList.add("show");
    errorMessage.classList.remove("show");
}

/* ===== Toggle New Password Visibility ===== */
document.addEventListener("DOMContentLoaded", function () {

    const pwd = document.getElementById("newPassword");
    const eye = document.getElementById("toggleNewPassword");

    if (!pwd || !eye) return;

    eye.addEventListener("click", function () {
        if (pwd.type === "password") {
            pwd.type = "text";
            eye.src = "/images/closed_eye.png";
        } else {
            pwd.type = "password";
            eye.src = "/images/open_eye.png";
        }
    });


    const confirmPwd = document.getElementById("confirmPassword");
    const confirmEye = document.getElementById("toggleConfirmPassword");

    if (confirmPwd && confirmEye) {
        confirmEye.addEventListener("click", function () {
            if (confirmPwd.type === "password") {
                confirmPwd.type = "text";
                confirmEye.src = "/images/closed_eye.png";
            } else {
                confirmPwd.type = "password";
                confirmEye.src = "/images/open_eye.png";
            }
        });
    }


});

</script>

</body>
</html> 
